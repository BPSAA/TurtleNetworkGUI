<w-loader ng-if="!$ctrl.loaded"></w-loader>

<div class="create-order"
     w-i18n-ns="app.dex"
     ng-if="$ctrl.loaded">

    <div class="head">
        <div class="icon-drag margin-right-1"></div>
        <div class="footnote-2 disabled-900">{{$ctrl.amountDisplayName}} / {{$ctrl.priceDisplayName}}</div>
        <div class="icon-close"
             ng-if="$ctrl.step !== 0"
             ng-click="$ctrl.closeCreateOrder()"></div>
    </div>

    <div class="body">

        <div class="making-order" ng-class="$ctrl.type">
            <div class="areas">
                <div class="area buy" ng-click="$ctrl.expand('buy')">
                    <div class="name headline-4 basic-700">BUY</div>
                </div>
                <div class="area sell" ng-click="$ctrl.expand('sell')">
                    <div class="name headline-4 basic-700">SELL</div>
                </div>
            </div>

            <div class="choice">
                <div class="choose buy" ng-click="$ctrl.expand('buy')">
                    <div class="name">BUY</div>
                    <div class="price"
                         w-nice-number="$ctrl.ask.price"
                         precision="$ctrl.priceBalance.asset.precision"></div>
                </div>
                <div class="middle caption-3 disabled-900">
                    <div>SPREAD</div>
                    <div>{{$ctrl.spreadPercent}}%</div>
                </div>
                <div class="choose sell" ng-click="$ctrl.expand('sell')">
                    <div class="name">SELL</div>
                    <div class="price"
                         w-nice-number="$ctrl.bid.price"
                         precision="$ctrl.priceBalance.asset.precision"></div>
                </div>
            </div>


            <div class="create-order-notification js-order-notification">
                <div ng-if="$ctrl.createOrderFailed">
                    <i></i>
                    <w-i18n>create.order.failed</w-i18n>
                </div>
                <div ng-if="!$ctrl.createOrderFailed">
                    <i></i>
                    <w-i18n>create.order.success</w-i18n>
                </div>
            </div>

            <div class="expandable">
                <form class="fields" novalidate name="order">
                    <div class="amount">
                        <div class="split-half field-label">
                            <div class="caption-2 disabled-900"
                                 w-i18n="directives.createOrder.amountField"></div>
                            <div ng-if="$ctrl.type === 'buy'"
                                 ng-click="$ctrl.setMaxPrice()"
                                 class="caption-2 disabled-900 underline-dashed">
                                <w-i18n params="{money: $ctrl.priceBalance}">money-currency</w-i18n>
                            </div>
                            <div ng-if="$ctrl.type === 'sell'"
                                 ng-click="$ctrl.setMaxAmount()"
                                 class="caption-2 disabled-900 underline-dashed">
                                <w-i18n params="{money: $ctrl.amountBalance}">money-currency</w-i18n>
                            </div>
                        </div>

                        <w-input-container>
                            <div class="input-like tiny">
                                <w-input class="tiny embed no-validate-icons"
                                         type="text"
                                         ng-focus="$ctrl.focusedInputName = 'amount'"
                                         ng-blur="$ctrl.focusedInputName = null"
                                         w-validate
                                         w-validator-asset="{{$ctrl.amountBalance.asset}}"
                                         w-validator-lte="{{$ctrl.maxAmountBalance}}"
                                         w-validator-custom="{{$ctrl.canBuyOrder}}"
                                         w-validator-gt="0"
                                         name="amount"
                                         ng-model="$ctrl.amount"
                                         required></w-input>
                                <div class="asset-name-wrap">
                                    <div class="caption-2caption-2 disabled-500">{{$ctrl.amountDisplayName}}</div>
                                </div>
                            </div>

                            <w-input-error message="required">
                                <w-i18n>directives.createOrder.errors.required</w-i18n>
                            </w-input-error>
                            <w-input-error message="gt">
                                <w-i18n>directives.createOrder.errors.required</w-i18n>
                            </w-input-error>
                            <w-input-error message="precision">
                                <w-i18n params="{precision: $ctrl.amountBalance.asset.precision}">
                                    directives.createOrder.errors.precision
                                </w-i18n>
                            </w-input-error>
                            <w-input-error message="lte">
                                <w-i18n params="{name: $ctrl.amountBalance.asset.displayName}">
                                    directives.createOrder.errors.balance
                                </w-i18n>
                            </w-input-error>
                        </w-input-container>
                    </div>

                    <div class="price">
                        <div class="split-half field-label">
                            <div class="caption-2 disabled-900" w-i18n="directives.createOrder.priceField"></div>
                            <div class="caption-2 disabled-900 flex">
                                <span ng-if="$ctrl.ask && $ctrl.ask.price && $ctrl.ask.price !== '0'"
                                      ng-class="{active: $ctrl.price.getTokens().toFixed() === $ctrl.ask.price}"
                                      ng-click="$ctrl.setAskPrice()" class="underline-dashed">
                                    <w-i18n>directives.createOrder.ask</w-i18n>
                                </span>
                                <span ng-if="$ctrl.bid && $ctrl.bid.price && $ctrl.bid.price !== '0'"
                                      ng-class="{active: $ctrl.price.getTokens().toFixed() === $ctrl.bid.price}"
                                      ng-click="$ctrl.setBidPrice()" class="underline-dashed">
                                    <w-i18n>directives.createOrder.bid</w-i18n>
                                </span>
                                <span ng-if="$ctrl.lastTradePrice"
                                      ng-class="{active: $ctrl.price.getTokens().toFixed() === $ctrl.lastTradePrice.getTokens().toFixed()}"
                                      ng-click="$ctrl.setLastPrice()" class="underline-dashed">
                                    <w-i18n>directives.createOrder.last</w-i18n>
                                </span>
                            </div>
                        </div>

                        <!-- todo @german - add class .invalid on w-input-container if inner input is not valid -->
                        <w-input-container>
                            <div class="input-like tiny">
                                <w-input class="tiny embed no-validate-icons"
                                         type="text"
                                         ng-focus="$ctrl.focusedInputName = 'price'"
                                         ng-blur="$ctrl.focusedInputName = null"
                                         w-validate
                                         w-validator-asset="{{$ctrl.priceBalance.asset}}"
                                         w-validator-gt="0"
                                         name="price"
                                         ng-model="$ctrl.price"
                                         required></w-input>
                                <div class="asset-name-wrap">
                                    <div class="caption-1 disabled-500">{{$ctrl.priceDisplayName}}</div>
                                </div>
                            </div>
                            <w-input-error message="precision">
                                <w-i18n params="{precision: $ctrl.priceBalance.asset.precision}">
                                    directives.createOrder.errors.precision
                                </w-i18n>
                            </w-input-error>
                            <w-input-error message="gt">
                                <w-i18n>directives.createOrder.errors.required</w-i18n>
                            </w-input-error>
                            <w-input-error message="required">
                                <w-i18n>directives.createOrder.errors.required</w-i18n>
                            </w-input-error>
                        </w-input-container>
                    </div>

                    <div class="total">
                        <w-input-container>
                            <div class="field-label caption-2 disabled-900"
                                 w-i18n="directives.createOrder.total"></div>
                            <div class="input-like tiny">
                                <w-input class="tiny embed no-validate-icons"
                                         type="text"
                                         name="total"
                                         ng-model="$ctrl.totalPrice"
                                         w-validate
                                         ng-focus="$ctrl.focusedInputName = 'total'"
                                         ng-blur="$ctrl.focusedInputName = null"
                                         w-validator-asset="{{$ctrl.priceBalance.asset}}"
                                         w-validator-gt="0"
                                         required></w-input>
                                <div class="asset-name-wrap">
                                    <div class="caption-1 disabled-500">{{$ctrl.priceDisplayName}}</div>
                                </div>
                            </div>
                            <span class="error active" ng-if="!$ctrl.canBuyOrder">
                                <w-i18n params="{name: $ctrl.priceBalance.asset.displayName}">
                                    directives.createOrder.errors.balance
                                </w-i18n>
                            </span>
                            <!--w-input-error message="">  <!-- todo validation @german -->
                            <!--w-i18n></w-i18n-->
                            <!--/w-input-error---->
                        </w-input-container>
                    </div>

                    <div class="expiration">                            <!-- todo @german -->
                        <div w-i18n="directives.createOrder.fee"></div> <!-- add params="fee (0.003) from API" // Fee {{fee}} WAVES-->
                        <div w-i18n="directives.createOrder.expiration"></div>
                        <w-select ng-model="$ctrl.expiration"><!-- todo past up-direction="true" to open up-->
                            <w-option ng-repeat="option in $ctrl.expirationValues track by option.name"
                                      value="::option.value">
                                <w-i18n w-i18n-ns="app.dex">directives.createOrder.{{::option.name}}</w-i18n>
                            </w-option>
                        </w-select>
                    </div>

                    <!-- todo @german -->
                    <!--span>&nbsp;{{$ctrl.totalPrice.toFormat($ctrl.priceBalance.asset.precision)}}</span-->

                    <w-button disabled="order.$invalid"
                              class="place-order small footnote-3"
                              on-click="$ctrl.createOrder($event, order)">
                        <w-i18n ng-if="$ctrl.type === 'sell'"
                                params="{name: $ctrl.amountBalance.asset.displayName}">
                            directives.createOrder.placeSellOrder
                        </w-i18n>
                        <w-i18n ng-if="$ctrl.type === 'buy'"
                                params="{name: $ctrl.amountBalance.asset.displayName}">
                            directives.createOrder.placeBuyOrder
                        </w-i18n>
                    </w-button>
                </form>
            </div>
        </div>

    </div>
</div>
